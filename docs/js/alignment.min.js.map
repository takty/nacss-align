{"version":3,"sources":["alignment.js"],"names":["window","NS","modifyAlign","as","cls","opts","aws","map","e","fn","doFirst","scrollListeners","push","throttle","onScroll","style","aw","a","w","switchFloatOne","getBoundingClientRect","width","assignWidths","onResize","pw","contentWidth","parentElement","nw","dataset","updateApplicableWidths","asw","minWidth","switchFloat","enabled","origCls","styleAlign","classList","remove","add","classCenter","elm","checkDisplay","innerWidth","s","getComputedStyle","display","ph","parseFloat","paddingLeft","paddingRight","clientWidth","addHasOnlyChild","es","styleHasOnlyChild","_addHasOnlyChild","c","Array","from","childNodes","nodeType","textContent","trim","enableClass","addNextTo","stylePrefixNextTo","prev","previousElementSibling","className","tn","tagName","toLowerCase","charAt","toUpperCase","slice","tar","val","key","substr","startsWith","isRunning","args","requestAnimationFrame","alignment","tars","Object","assign","classLeft","classRight","doAddSelectorAttribute","doReplaceAlignClass","allowedClassesForImage","als","document","getElementsByClassName","ars","acs","setTimeout","resizeListeners","addEventListener","l","passive"],"mappings":"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","file":"alignment.min.js","sourcesContent":["/**\n *\n * Align Style (JS)\n *\n * @author Takuto Yanagida\n * @version 2021-10-26\n *\n */\n\n\nwindow['NACSS'] = window['NACSS'] || {};\n\n\n(function (NS) {\n\n\t/**\n\t *\n\t * Alignment Classes (JS)\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-27\n\t *\n\t */\n\t\n\t\n\tfunction initialize(tars = [], opts = {}) {\n\t\t// if (tars.length === 0) return;\n\t\n\t\topts = Object.assign({\n\t\t\tstyleAlign            : ':ncAlign',\n\t\t\tstyleHasOnlyChild     : ':ncHasOnlyChild',\n\t\t\tstylePrefixNextTo     : ':ncNextTo',\n\t\t\tclassLeft             : 'alignleft',\n\t\t\tclassRight            : 'alignright',\n\t\t\tclassCenter           : 'aligncenter',\n\t\t\tminWidth              : 240,  // px\n\t\t\tdoAddSelectorAttribute: true,\n\t\t\tdoReplaceAlignClass   : true,\n\t\n\t\t\tallowedClassesForImage: [\n\t\t\t\t'alignleft',\n\t\t\t\t'aligncenter',\n\t\t\t\t'alignright',\n\t\t\t\t'size-thumbnail',\n\t\t\t\t'size-small',\n\t\t\t\t'size-medium-small',\n\t\t\t\t'size-medium',\n\t\t\t\t'size-medium-large',\n\t\t\t\t'size-medium_large',\n\t\t\t\t'size-large',\n\t\t\t\t'size-full'\n\t\t\t]\n\t\t}, opts);\n\t\n\t\tconst als = Array.from(document.getElementsByClassName(opts.classLeft));\n\t\tconst ars = Array.from(document.getElementsByClassName(opts.classRight));\n\t\tconst acs = Array.from(document.getElementsByClassName(opts.classCenter));\n\t\n\t\tif (opts.doAddSelectorAttribute) {\n\t\t\taddHasOnlyChild(als, opts.styleHasOnlyChild);\n\t\t\taddHasOnlyChild(ars, opts.styleHasOnlyChild);\n\t\t\taddHasOnlyChild(acs, opts.styleHasOnlyChild);\n\t\t\taddNextTo(als, opts.stylePrefixNextTo);\n\t\t\taddNextTo(ars, opts.stylePrefixNextTo);\n\t\t}\n\t\t// if (opts.doReplaceAlignClass) {\n\t\t// \treplaceAlignClass(als, opts);\n\t\t// \treplaceAlignClass(ars, opts);\n\t\t// \treplaceAlignClass(acs, opts);\n\t\t// }\n\t\tsetTimeout(() => {\n\t\t\tmodifyAlign(als, opts.classLeft, opts);\n\t\t\tmodifyAlign(ars, opts.classRight, opts);\n\t\t}, 0);  // Delay\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction modifyAlign(as, cls, opts) {\n\t\tconst aws = as.map(e => [e, 0]);\n\t\tonScroll(() => assignWidths(aws, cls, opts), true);  // For lazy image loading\n\t\tonResize(() => {\n\t\t\tupdateApplicableWidths(aws, opts);\n\t\t\tswitchFloat(aws, cls, opts);\n\t\t}, true);\n\t}\n\t\n\tfunction assignWidths(aws, style, opts) {\n\t\tfor (const aw of aws) {\n\t\t\tconst [a, w] = aw;\n\t\t\tif (10 < w) continue;\n\t\t\tswitchFloatOne(a, false, style, opts);\n\t\t\taw[1] = a.getBoundingClientRect().width;\n\t\t\tswitchFloatOne(a, true, style, opts);\n\t\t}\n\t}\n\t\n\tfunction updateApplicableWidths(aws, opts) {\n\t\tfor (const aw of aws) {\n\t\t\tconst [a, w] = aw;\n\t\t\tconst pw = contentWidth(a.parentElement);\n\t\t\tconst nw = a.getBoundingClientRect().width;\n\t\t\tif (nw < pw * 0.9 && w < nw) aw[1] = nw;\n\t\n\t\t\ta.dataset['w'] = nw;\n\t\t}\n\t}\n\t\n\tfunction switchFloat(asw, cls, opts) {\n\t\tfor (const [a, w] of asw) {\n\t\t\tconst pw = contentWidth(a.parentElement, true);\n\t\t\tswitchFloatOne(a, pw - w < opts.minWidth, cls, opts);\n\t\t}\n\t}\n\t\n\tfunction switchFloatOne(a, enabled, origCls, opts) {\n\t\tif (enabled && !a.dataset[opts.styleAlign]) {\n\t\t\ta.dataset[opts.styleAlign] = origCls;\n\t\t\ta.classList.remove(origCls);\n\t\t\ta.classList.add(opts.classCenter);\n\t\t}\n\t\tif (!enabled && a.dataset[opts.styleAlign]) {\n\t\t\ta.classList.remove(opts.classCenter);\n\t\t\ta.classList.add(a.dataset[opts.styleAlign]);\n\t\t\tdelete a.dataset[opts.styleAlign];\n\t\t}\n\t}\n\t\n\tfunction contentWidth(elm, checkDisplay = false) {\n\t\tif (elm === null) return window.innerWidth;\n\t\tconst s = getComputedStyle(elm);\n\t\tif (checkDisplay && s.display === 'inline') {\n\t\t\treturn contentWidth(elm.parentElement);\n\t\t}\n\t\tconst ph = parseFloat(s.paddingLeft) + parseFloat(s.paddingRight);\n\t\treturn elm.clientWidth - ph;\n\t}\n\t\n\t\n\t// -------------------------------------------------------------------------\n\t\n\t\n\tfunction replaceAlignClass(ts, opts) {\n\t\tfor (let i = 0; i < ts.length; i += 1) {\n\t\t\tconst t = ts[i];\n\t\t\tconst p = t.parentNode;\n\t\t\tlet replace = false;\n\t\t\tif (p.tagName === 'A' && isImageLink(p, opts.allowedClassesForImage)) {\n\t\t\t\tif (moveClass(t, p, opts.classLeft)) replace = true;\n\t\t\t\tif (moveClass(t, p, opts.classRight)) replace = true;\n\t\t\t\tif (moveClass(t, p, opts.aligncenter)) replace = true;\n\t\t\t}\n\t\t\tif (replace) ts[i] = p;\n\t\t}\n\t}\n\t\n\tfunction moveClass(c, p, cls) {\n\t\tif (c.classList.contains(cls)) {\n\t\t\tc.classList.remove(cls);\n\t\t\tp.classList.add(cls);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\t\n\tNS.alignment = initialize;\n\n\t/**\n\t *\n\t * Selector Attributes\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-26\n\t *\n\t */\n\t\n\t\n\tfunction addHasOnlyChild(es, styleHasOnlyChild) {\n\t\tfor (const e of es) _addHasOnlyChild(e, styleHasOnlyChild);\n\t}\n\t\n\tfunction _addHasOnlyChild(e, styleHasOnlyChild) {\n\t\tfor (const c of Array.from(e.parentElement.childNodes)) {\n\t\t\tif (c.nodeType === 3 /*TEXT_NODE*/ && c.textContent.trim() !== '') {\n\t\t\t\treturn;\n\t\t\t} else if (c.nodeType === 1 /*ELEMENT_NODE*/ && c !== e) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tenableClass(true, e.parentElement, styleHasOnlyChild);\n\t}\n\t\n\tfunction addNextTo(es, stylePrefixNextTo) {\n\t\tfor (const e of es) {\n\t\t\tconst prev = e.previousElementSibling;\n\t\t\tif (prev && prev.className === '') {\n\t\t\t\tconst tn = prev.tagName.toLowerCase();\n\t\t\t\tconst cc = tn.charAt(0).toUpperCase() + tn.slice(1);\n\t\t\t\tenableClass(true, e, stylePrefixNextTo + cc);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Image Link\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-27\n\t *\n\t */\n\t\n\t\n\tfunction isImageLink(a, allowedClasses) {\n\t\tif (a.className) {\n\t\t\tconst cs = a.className.split(' ');\n\t\t\tfor (const c of cs) {\n\t\t\t\tif (allowedClasses.indexOf(c) === -1) return false;\n\t\t\t}\n\t\t}\n\t\tconst cs = Array.from(a.childNodes);\n\t\tif (cs.length === 0) return false;\n\t\tlet success = false;\n\t\tfor (const c of cs) {\n\t\t\tconst tn = c.tagName;\n\t\t\tif (success === false && tn === 'IMG') {\n\t\t\t\tsuccess = true;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (tn) return false;\n\t\t}\n\t\treturn success;\n\t}\n\t\n\t/**\n\t *\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-10-27\n\t *\n\t */\n\t\n\t\n\tfunction enableClass(enabled, tar, cls, val = '') {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = val;\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(key);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(key);\n\t\t\t}\n\t\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\tfunction getScrollOffset() {\n\t\tconst s = getComputedStyle(document.getElementsByTagName('html')[0]);\n\t\treturn parseInt(s.scrollPaddingTop);\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\tconst scrollListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tfunction onScroll(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tscrollListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t\twindow.addEventListener('scroll', () => {\n\t\t\tfor (const l of scrollListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction onIntersect(fn, targets, threshold) {\n\t\tconst vs = Array(targets.length).fill(false);\n\t\tconst tm = new Map();\n\t\ttargets.forEach((t, i) => tm.set(t, i));\n\t\n\t\tfunction init() {\n\t\t\tconst io = new IntersectionObserver((es) => {\n\t\t\t\tfor (const e of es) vs[tm.get(e.target)] = e.isIntersecting;\n\t\t\t\tfn(vs);\n\t\t\t}, { rootMargin: `${mt}px 0px 0px 0px`, threshold });\n\t\t\tfor (const t of targets) io.observe(t);\n\t\t\treturn io;\n\t\t}\n\t\tlet mt = 0;\n\t\tlet io = null;\n\t\tlet st = null;\n\t\tonResize(() => {\n\t\t\tmt = -getScrollOffset();\n\t\t\tif (st) clearTimeout(st);\n\t\t\tst = setTimeout(() => {\n\t\t\t\tif (io) io.disconnect();\n\t\t\t\tio = init();\n\t\t\t}, 100);\n\t\t}, true);\n\t}\n\t\n\n})(window['NACSS']);\n"]}